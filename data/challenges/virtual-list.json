{
  "id": "virtual-list",
  "title": "Image Virtual List",
  "domain": "performance-scalability",
  "subcategory": "rendering-optimization",
  "difficulty": "Senior",
  "statement": "Bạn có một danh sách 10.000 sản phẩm, mỗi sản phẩm có một hình ảnh dung lượng lớn. Nếu render tất cả cùng lúc, trình duyệt sẽ bị treo. Hãy đưa ra giải pháp virtualization.",
  "constraints": [
    "Chỉ render những item trong viewport.",
    "Lazy load hình ảnh.",
    "Sử dụng buffer để tránh khoảng trắng khi scroll nhanh."
  ],
  "complexity": "Render: O(k) với k là số item visible trong viewport.",
  "codeLines": [
    "import React, { useRef, useState } from \"react\";",
    "",
    "const ITEM_HEIGHT = 100;",
    "const WINDOW_HEIGHT = 500;",
    "const BUFFER = 5;",
    "",
    "export const VirtualList = ({ items }: { items: any[] }) => {",
    "  const [scrollTop, setScrollTop] = useState(0);",
    "  const containerRef = useRef<HTMLDivElement>(null);",
    "",
    "  const onScroll = (e: React.UIEvent<HTMLDivElement>) => {",
    "    setScrollTop(e.currentTarget.scrollTop);",
    "  };",
    "",
    "  const startIndex = Math.max(0, Math.floor(scrollTop / ITEM_HEIGHT) - BUFFER);",
    "  const endIndex = Math.min(",
    "    items.length - 1,",
    "    Math.floor((scrollTop + WINDOW_HEIGHT) / ITEM_HEIGHT) + BUFFER",
    "  );",
    "",
    "  const visibleItems = items.slice(startIndex, endIndex + 1);",
    "  const totalHeight = items.length * ITEM_HEIGHT;",
    "  const offsetY = startIndex * ITEM_HEIGHT;",
    "",
    "  return (",
    "    <div",
    "      ref={containerRef}",
    "      onScroll={onScroll}",
    "      style={{ height: WINDOW_HEIGHT, overflowY: \"auto\", position: \"relative\" }}",
    "    >",
    "      <div style={{ height: totalHeight, width: \"100%\" }}>",
    "        <div",
    "          style={{",
    "            position: \"absolute\",",
    "            top: 0,",
    "            transform: `translateY(${offsetY}px)`,",
    "            width: \"100%\",",
    "          }}",
    "        >",
    "          {visibleItems.map((item) => (",
    "            <div key={item.id} style={{ height: ITEM_HEIGHT }}>",
    "              <img",
    "                src={item.thumb}",
    "                loading=\"lazy\",",
    "                alt={item.title}",
    "                style={{ height: \"80px\" }}",
    "              />",
    "              {item.title}",
    "            </div>",
    "          ))}",
    "        </div>",
    "      </div>",
    "    </div>",
    "  );",
    "};"
  ],
  "language": "tsx",
  "commonMistakes": [
    "Không tính toán `offsetY` (transform), dẫn đến việc các item bị dồn lên top.",
    "Không sử dụng `buffer`, khiến user thấy khoảng trắng khi scroll nhanh.",
    "Render toàn bộ 10.000 DOM nodes nhưng chỉ ẩn bằng CSS `display: none`."
  ],
  "demoComponentKey": "virtual-list"
}
